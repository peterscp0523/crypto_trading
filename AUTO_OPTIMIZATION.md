## 🤖 완전 자동 최적화 시스템

이 시스템은 **Oracle DB 데이터 기반**으로 거래 성과를 자동 분석하고, 필요시 파라미터를 자동 조정합니다.

---

## 📊 작동 방식

### 1. **매일 자동 분석** (새벽 3시)

```
┌─────────────┐
│ GitHub      │
│ Actions     │ ← 매일 3am 실행
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│ Oracle DB       │
│ 최근 7일 거래   │ ← 성과 데이터 조회
│ 분석            │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 성과 평가       │
│ - 승률 50% 이상?│
│ - 수익률 0.5%+? │
│ - 거래 충분?    │
└──────┬──────────┘
       │
       ├─── ✅ 양호 → 종료
       │
       └─── ❌ 미달 → 최적화
              │
              ▼
       ┌─────────────────┐
       │ 파라미터 자동    │
       │ 조정            │
       │ - RSI 완화      │
       │ - 거래량 완화   │
       │ - 볼린저 확대   │
       └──────┬──────────┘
              │
              ▼
       ┌─────────────────┐
       │ GitHub PR 생성  │
       │                 │
       │ 승률 < 40%면    │
       │ 자동 머지 ⚡    │
       └──────┬──────────┘
              │
              ▼
       ┌─────────────────┐
       │ 텔레그램 알림   │
       │ 📱              │
       └─────────────────┘
```

### 2. **성과 기준**

| 지표 | 목표 | 조치 |
|------|------|------|
| **승률** | 50% 이상 | < 50%면 RSI 완화 |
| **평균 수익률** | 0.5% 이상 | < 0.5%면 익절 타겟 상향 |
| **거래 빈도** | 하루 1회 이상 | 부족하면 볼린저 확대 |
| **최소 거래 수** | 10건 이상 | 미달 시 분석 스킵 |

### 3. **긴급 개입 조건**

**승률 < 40%** 일 때:
- ⚡ 즉시 자동 최적화 적용 (PR 자동 머지)
- 📱 텔레그램 긴급 알림
- 🔧 RSI 대폭 완화 (42 → 48)
- 📊 거래량 조건 대폭 완화 (0.95 → 0.85)

---

## 🚀 설정 방법

### 1. GitHub Secrets 추가

GitHub 저장소 → Settings → Secrets and variables → Actions

필요한 Secrets:
```
ORACLE_DB_USER=ADMIN
ORACLE_DB_PASSWORD=your_password
ORACLE_DB_DSN=your_dsn
ORACLE_WALLET_BASE64=your_wallet_base64
ANTHROPIC_API_KEY=sk-ant-...  ← (선택적, Claude API 사용 시)
TELEGRAM_TOKEN=your_token
TELEGRAM_CHAT_ID=your_chat_id
```

### 2. 수동 실행 테스트

GitHub → Actions → "Auto-Optimize Trading Bot" → Run workflow

### 3. 자동 실행 확인

매일 새벽 3시에 자동 실행되며:
- 성과 분석 결과가 GitHub Actions 로그에 표시
- 최적화 필요 시 PR 자동 생성
- 텔레그램으로 알림 전송

---

## 📋 최적화 예시

### 시나리오 1: 승률 45% (목표 미달)

**분석 결과**:
```
총 거래: 25회
승률: 45% (목표: 50%)
평균 수익률: 0.8%
```

**자동 조정**:
- RSI: 42 → 45 (더 자주 매수)
- 이유: "승률 45% (목표: 50%)"

**결과**: PR 생성 → 리뷰 후 수동 머지

---

### 시나리오 2: 승률 35% (긴급)

**분석 결과**:
```
총 거래: 30회
승률: 35% (⚠️ 긴급)
평균 수익률: -0.2%
```

**자동 조정**:
- RSI: 42 → 48 (대폭 완화)
- 거래량: 0.95 → 0.85 (대폭 완화)
- 이유: "승률 35% (긴급: < 40%)"

**결과**: PR 생성 → **자동 머지** ⚡ → 즉시 배포

---

### 시나리오 3: 거래 빈도 낮음

**분석 결과**:
```
총 거래: 5회 (7일)
승률: 60% (양호)
평균 수익률: 1.2%
```

**자동 조정**:
- 볼린저: 1.10~1.20 → 1.15~1.25 (범위 확대)
- 이유: "거래 빈도 낮음 (5회/7일)"

**결과**: PR 생성 → 리뷰 후 수동 머지

---

## 🔍 모니터링

### GitHub Actions 로그 확인

```bash
# 로그에서 확인 가능한 정보
✅ Oracle DB 연결 성공
📊 분석 완료: 25건, 승률 45.0%
🔧 최적화 적용 중... (2개 변경)
✅ 최적화 완료!
```

### 텔레그램 알림

**성과 양호 시**:
```
✅ 성과 양호
━━━━━━━━━━━━━━━━━
📊 거래 성과가 목표치를 충족하고 있습니다.
🎯 최적화가 필요하지 않습니다.
```

**최적화 필요 시**:
```
🤖 자동 최적화 실행됨
━━━━━━━━━━━━━━━━━
📊 거래 성과가 목표치 미달로 파라미터를 자동 조정했습니다.
✅ GitHub에 PR이 생성되었습니다.
```

---

## ⚙️ 커스터마이징

### 성과 기준 변경

[scripts/auto_optimizer.py](scripts/auto_optimizer.py) 파일 수정:

```python
# 성과 기준
MIN_WIN_RATE = 50.0  # 최소 승률 50% → 원하는 값
MIN_PROFIT_RATE = 0.5  # 최소 평균 수익률 0.5% → 원하는 값
CRITICAL_WIN_RATE = 40.0  # 긴급 개입 승률 40% → 원하는 값
MIN_TRADES = 10  # 최소 거래 횟수 10 → 원하는 값
```

### 실행 주기 변경

[.github/workflows/auto-optimize.yml](.github/workflows/auto-optimize.yml) 파일 수정:

```yaml
on:
  schedule:
    - cron: '0 3 * * *'  # 매일 3시 → 원하는 시간
    # 예시:
    # - cron: '0 */6 * * *'  # 6시간마다
    # - cron: '0 3 * * 0'    # 매주 일요일 3시
```

---

## 🎯 예상 효과

### 1개월 후:
- 자동 최적화 횟수: 3-5회
- 승률 개선: +5-10%p
- 수익률 안정화

### 3개월 후:
- 최적 파라미터 수렴
- 자동 조정 빈도 감소 (시스템 안정화)
- 지속적인 성과 유지

### 1년 후:
- 완전 자율 운영
- 시장 변화에 자동 적응
- 장기 수익 극대화

---

## 🔒 보안

- Oracle DB 비밀번호는 GitHub Secrets에 암호화 저장
- Wallet은 Base64로 인코딩되어 안전하게 전송
- 자동 머지는 긴급 상황(승률 < 40%)에만 실행
- 모든 변경사항은 Git 히스토리에 기록

---

## 📚 참고

- [GitHub Actions 문서](https://docs.github.com/en/actions)
- [Oracle DB Python Driver](https://python-oracledb.readthedocs.io/)
- [Claude API](https://docs.anthropic.com/)
